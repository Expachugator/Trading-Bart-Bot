const fetch = require('node-fetch');

var btc_price;
btcPrice();

arrayBtc = new Array(10);

var mediaBtc;
var i=-1;
var btcArriba;
var btcAbajo;

for (a=0; a<arrayBtc.length; a++){
        arrayBtc[a] = btc_price;
}

setInterval(controlador,1000);

async function controlador() {

        if (i == 10){
                i = 0;
        } else {
                i++;
        }

        btcPrice();
        arrayBtc[i] = btc_price;
        console.log("Precio BTC/USD: "+btc_price);
        mediaBtc = 0;

        for (a=0; a<arrayBtc.length; a++){
                mediaBtc = mediaBtc + parseFloat(arrayBtc[a]);
        }
        mediaBtc = mediaBtc / arrayBtc.length;
        console.log("Media: "+mediaBtc);
        btcArriba = mediaBtc * 1.1;
        btcAbajo = mediaBtc * 0.9;
        console.log("arriba: "+ btcArriba);
        console.log("abajo: "+ btcAbajo);
        if (i == 10){
                i = 0;
        } else {
                i++;
        }

        btcPrice();
        arrayBtc[i] = btc_price;
        console.log("Precio BTC/USD: "+btc_price);
        mediaBtc = 0;

        for (a=0; a<arrayBtc.length; a++){
                mediaBtc = mediaBtc + parseFloat(arrayBtc[a]);
        }
        mediaBtc = mediaBtc / arrayBtc.length;
        console.log("Media: "+mediaBtc);
        btcArriba = mediaBtc * 1.05;
        btcAbajo = mediaBtc * 0.95;
        console.log("arriba: "+ btcArriba);
        console.log("abajo: "+ btcAbajo);

        if (arrayBtc[i] > btcArriba) {
                console.log("Posible Bart subida brusca");
//                fetch();

        } else if (arrayBtc[i] < btcAbajo) {
                console.log("Posible Bart bajada brusca");
//                fetch();
        }
        console.log();
}

async function btcPrice() {
        let btc_price_res = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');
        btc_price_res = await btc_price_res.json();
        btc_price = btc_price_res.price
}
